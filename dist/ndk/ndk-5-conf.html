<!DOCTYPE html><html><head><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta charset="utf-8"><title>基于已有项目的NDK环境配置 - Android NDK开发之旅</title><meta name="description" content=""><meta name="author" content=""><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><link rel="stylesheet" href="../assets/css/bulma.min.css"><link rel="stylesheet" href="../assets/css/app.css"><!--[if lt IE 9]>
<script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]--><link rel="shortcut icon" href=""></head><body dir="ltr"><nav class="columns navbar"><div class="column logo is-3 is-offset-1"><a class="is-brand" href="../index.html">Android NDK开发之旅</a></div></nav><div class="columns content"><div class="column is-2-desktop is-3-widescreen is-hidden-touch"></div><div class="column article-container is-11-tablet is-8-desktop is-6-widescreen"><div class="breadcrumb-area"><a href="../index.html" class="breadcrumb-item">Home</a><span class="breadcrumb-delimiter"> &gt; </span><a href="../ndk/index.html" class="breadcrumb-item">Android NDK编写</a><span class="breadcrumb-delimiter"> &gt; </span><a href="../ndk/ndk-5-conf.html" class="breadcrumb-item">基于已有项目的NDK环境配置</a></div><h1 class="article-title">基于已有项目的NDK环境配置</h1><div class="article"><p>最近有朋友跟我留言，关于以前的项目，没有勾选Include C++ Support的项目，怎样配置，才能支持NDK开发 ，特写一篇文章予以说明 。这个问题被我搁置了几天，一来是因为最近在赶项目没时间，二来我也没这样做过，所以得自己做一下试验 。</p><p>对于这类问题 ， 其实可以做一下简要的分析：</p><blockquote><p>勾选了Include C++ Support为我们做了什么 ？</p></blockquote><p>① 为我们配置好的NDK环境<br>② 创建了CPP目录<br>③ 创建CMakeLists.txt文件，主要用于cmake工程构建配置<br>④ 在gradle中做了如下配置</p><pre class="hljs"><code>// 配置cmake build 参数
externalNativeBuild {
    cmake {
        arguments &quot;-DANDROID_TOOLCHAIN=clang&quot;
        abiFilters &quot;armeabi-v7a&quot;, &quot;armeabi&quot;,&quot;x86&quot;
    }
}

 // cmake构建的配置文件
externalNativeBuild {
    cmake {
        path &quot;CMakeLists.txt&quot;
    }
}
</code></pre><p>分析完之后 ， 我们照着配置就OK了 ， 下面为Demo流程 。</p><h2 id="已有项目配置ndk开发环境">已有项目配置NDK开发环境 <a class="markdownIt-Anchor" href="#已有项目配置ndk开发环境">#</a></h2><blockquote><p>一 ， 配置NDK环境</p></blockquote><figure><img src="http://upload-images.jianshu.io/upload_images/643851-6955652b0611157a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="NDK config project"><figcaption>NDK config project</figcaption></figure><blockquote><p>二 ， 新建CPP</p></blockquote><p>将项目目录视图，切换到project视图，在main目录下，新建cpp目录</p><figure><img src="http://upload-images.jianshu.io/upload_images/643851-1834b7115e67313e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="new cpp dir"><figcaption>new cpp dir</figcaption></figure><blockquote><p>三 ，创建CMakeLists.txt</p></blockquote><p>选中app右键新建文件，文件名为CMakeLists.txt，然后将以前创建好的NDK的CMakeLists.txt复制过来，或者直接复制粘贴文件也是可行的 。</p><figure><img src="http://upload-images.jianshu.io/upload_images/643851-9b1c5ed12441f853.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="创建CMakeLists.txt文件"><figcaption>创建CMakeLists.txt文件</figcaption></figure><blockquote><p>四 ， 配置gradle<br>配置好gradle之后，NDK环境才算是真正搭建好 。</p></blockquote><figure><img src="http://upload-images.jianshu.io/upload_images/643851-2c34a507ce4e6db7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="config gradle"><figcaption>config gradle</figcaption></figure><blockquote><p>五 ， 编写测试</p></blockquote><p>很简单的代码</p><figure><img src="http://upload-images.jianshu.io/upload_images/643851-98ea653deefa4d3f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="test"><figcaption>test</figcaption></figure><p><strong>显示结果：</strong></p><figure><img src="http://upload-images.jianshu.io/upload_images/643851-7b704afe227343c9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ndk"><figcaption>ndk</figcaption></figure><h2 id="结语">结语 <a class="markdownIt-Anchor" href="#结语">#</a></h2><p>这种问题的思路，其实很简单 ， 建立在已有的案例基础上，这种问题是最好解决的 ， 首先要观察和分析已有案例的和现有项目的区别，然后，通过手动补齐配置和一些参数变量等等 。</p></div><div dir="ltr" class="level article-bar is-mobile"><div class="level-item has-text-centered"><a title="previous page" class="previouse-article-link" href="../ndk/ndk-4-update-2.html"><span class="icon icon-previous" data-icon="previous"></span><span class="link-content">&laquo; Previous</span></a></div><div class="level-item has-text-centered"><a title="font size" class="link-item link-item-size"><span class="icon icon-size" data-icon="size"></span></a></div><div class="level-item has-text-centered"><a title="table of content" class="link-item link-item-toc"><span class="icon icon-toc" data-icon="toc"></span></a></div><div class="level-item has-text-centered"><a title="top" href="#"><span class="icon icon-up" data-icon="up"></span> <span class="link-content">⤊ Top</span></a></div><div class="level-item has-text-centered"><a title="next page" class="next-article-link link-disabled"><span class="icon icon-next-disabled" data-icon="next-disabled"></span></a></div></div></div><div class="column is-2-widescreen is-hidden"></div></div><div class="columns foot"><div class="column is-3 is-offset-9 build-by">Build by <a href="https://github.com/ruanyf/loppo" target="_blank">Loppo</a> 0.6.15</div></div><div class="book-toc notification is-warning is-hidden"><h3>Table of chapters &nbsp;<span class="title-close"><a class="button is-danger"> Close</a></span></h3><ul class="chapter-area"><li class="chapter-item"><a href="../c/index.html">C语言基础</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-expand" data-icon="expand"></span></a></li><ul class="chapter-level-1"><li class="chapter-item"><a href="../c/c-1-basic.html">基础语法</a></li><li class="chapter-item"><a href="../c/c-2-pointer.html">指针内存分析</a></li><li class="chapter-item"><a href="../c/c-3-func-2pointer.html">函数与二级指针</a></li><li class="chapter-item"><a href="../c/c-4-func-pointer.html">函数指针</a></li><li class="chapter-item"><a href="../c/c-5-dynamic-m.html">动态内存分配</a></li><li class="chapter-item"><a href="../c/c-6-str-op.html">字符操作</a></li><li class="chapter-item"><a href="../c/c-7-struct-pointer.html">结构体与指针</a></li><li class="chapter-item"><a href="../c/c-8-file-io.html">文件IO</a></li><li class="chapter-item"><a href="../c/c-9-enum.html">联合体与枚举</a></li><li class="chapter-item"><a href="../c/c-10-jni.html">预编译及jni-h分析</a></li></ul><li class="chapter-item"><a href="../cpp/index.html">C++基础</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-expand" data-icon="expand"></span></a></li><ul class="chapter-level-1"><li class="chapter-item"><a href="../cpp/cpp-1-namespace-struct-ref.html">命名空间结构体和引用</a></li><li class="chapter-item"><a href="../cpp/cpp-2-constructor-copy_func.html">构造函数，析构函数，拷贝构造函数</a></li><li class="chapter-item"><a href="../cpp/cpp-3-oop.html">new对象，继承，友元函数，函数的可变参数</a></li><li class="chapter-item"><a href="../cpp/cpp-4-template-exception.html">多态，模板，异常</a></li></ul><li class="chapter-item"><a href="../jni/index.html">Java与C通信的桥梁-JNI</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-expand" data-icon="expand"></span></a></li><ul class="chapter-level-1"><li class="chapter-item"><a href="../jni/jni-1-basic.html">JNI概念及开发流程</a></li><li class="chapter-item"><a href="../jni/jni-2-h-file.html">头文件分析</a></li><li class="chapter-item"><a href="../jni/jni-3-call-java-field-method.html">C语言调用Java字段与方法</a></li><li class="chapter-item"><a href="../jni/jni-4-call-constructor-method.html">C语言调用构造方法</a></li><li class="chapter-item"><a href="../jni/jni-5-ref-handle.html">对象引用的处理</a></li></ul><li class="chapter-item"><a href="../ndk/index.html">Android NDK编写</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-collapse" data-icon="collapse"></span></a></li><ul class="chapter-level-1 chapter-level-1-current"><li class="chapter-item"><a href="../ndk/ndk-1-as-ndk.html">使用Android-Studio编写NDK</a></li><li class="chapter-item"><a href="../ndk/ndk-2-file-split-join.html">文件加密解密与分割合并</a></li><li class="chapter-item"><a href="../ndk/ndk-3-update-1.html">增量更新之服务器端生成差分包</a></li><li class="chapter-item"><a href="../ndk/ndk-4-update-2.html">增量更新之客户端合并差分包</a></li><li class="chapter-item chapter-item-current"><a href="../ndk/ndk-5-conf.html">基于已有项目的NDK环境配置</a></li></ul></ul></div><div class="progress-indicator"></div><!-- SCRIPTS --><script>var LOPPO={current_path:"ndk/ndk-5-conf.md",relative_root_path:"../",article_toc:'<ul class="markdownIt-TOC">\n<li><a href="#%E5%B7%B2%E6%9C%89%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AEndk%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83">已有项目配置NDK开发环境</a></li>\n<li><a href="#%E7%BB%93%E8%AF%AD">结语</a></li>\n</ul>\n'}</script><script src="../assets/js/app.js"></script></body></html>